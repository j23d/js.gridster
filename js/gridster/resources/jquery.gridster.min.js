/*! gridster.js - v0.2.1 - 2013-10-28
* http://gridster.net/
* Copyright (c) 2013 ducksboard; Licensed MIT */
;(function(e,d,a,f){function b(g){if(g[0]&&e.isPlainObject(g[0])){this.data=g[0]}else{this.el=g}this.isCoords=true;this.coords={};this.init();return this}var c=b.prototype;c.init=function(){this.set();this.original_coords=this.get()};c.set=function(k,g){var h=this.el;if(h&&!k){this.data=h.offset();this.data.width=h.width();this.data.height=h.height()}if(h&&k&&!g){var j=h.offset();this.data.top=j.top;this.data.left=j.left}var i=this.data;this.coords.x1=i.left;this.coords.y1=i.top;this.coords.x2=i.left+i.width;this.coords.y2=i.top+i.height;this.coords.cx=i.left+(i.width/2);this.coords.cy=i.top+(i.height/2);this.coords.width=i.width;this.coords.height=i.height;this.coords.el=h||false;return this};c.update=function(h){if(!h&&!this.el){return this}if(h){var g=e.extend({},this.data,h);this.data=g;return this.set(true,true)}this.set(true);return this};c.get=function(){return this.coords};e.fn.coords=function(){if(this.data("coords")){return this.data("coords")}var g=new b(this,arguments[0]);this.data("coords",g);return g}}(jQuery,window,document));(function(d,c,a,f){var e={colliders_context:a.body};function g(i,j,h){this.options=d.extend(e,h);this.$element=i;this.last_colliders=[];this.last_colliders_coords=[];if(typeof j==="string"||j instanceof jQuery){this.$colliders=d(j,this.options.colliders_context).not(this.$element)}else{this.colliders=d(j)}this.init()}var b=g.prototype;b.init=function(){this.find_collisions()};b.overlaps=function(j,i){var h=false;var k=false;if((i.x1>=j.x1&&i.x1<=j.x2)||(i.x2>=j.x1&&i.x2<=j.x2)||(j.x1>=i.x1&&j.x2<=i.x2)){h=true}if((i.y1>=j.y1&&i.y1<=j.y2)||(i.y2>=j.y1&&i.y2<=j.y2)||(j.y1>=i.y1&&j.y2<=i.y2)){k=true}return(h&&k)};b.detect_overlapping_region=function(i,h){var k="";var j="";if(i.y1>h.cy&&i.y1<h.y2){k="N"}if(i.y2>h.y1&&i.y2<h.cy){k="S"}if(i.x1>h.cx&&i.x1<h.x2){j="W"}if(i.x2>h.x1&&i.x2<h.cx){j="E"}return(k+j)||"C"};b.calculate_overlapped_area_coords=function(i,h){var k=Math.max(i.x1,h.x1);var m=Math.max(i.y1,h.y1);var j=Math.min(i.x2,h.x2);var l=Math.min(i.y2,h.y2);return d({left:k,top:m,width:(j-k),height:(l-m)}).coords().get()};b.calculate_overlapped_area=function(h){return(h.width*h.height)};b.manage_colliders_start_stop=function(p,n,q){var o=this.last_colliders_coords;for(var m=0,h=o.length;m<h;m++){if(d.inArray(o[m],p)===-1){n.call(this,o[m])}}for(var k=0,l=p.length;k<l;k++){if(d.inArray(p[k],o)===-1){q.call(this,p[k])}}};b.find_collisions=function(r){var t=this;var l=[];var m=[];var o=(this.colliders||this.$colliders);var p=o.length;var j=t.$element.coords().update(r||false).get();while(p--){var h=t.$colliders?d(o[p]):o[p];var v=(h.isCoords)?h:h.coords();var u=v.get();var k=t.overlaps(j,u);if(!k){continue}var q=t.detect_overlapping_region(j,u);if(q==="C"){var s=t.calculate_overlapped_area_coords(j,u);var i=t.calculate_overlapped_area(s);var n={area:i,area_coords:s,region:q,coords:u,player_coords:j,el:h};if(t.options.on_overlap){t.options.on_overlap.call(this,n)}l.push(v);m.push(n)}}if(t.options.on_overlap_stop||t.options.on_overlap_start){this.manage_colliders_start_stop(l,t.options.on_overlap_start,t.options.on_overlap_stop)}this.last_colliders_coords=l;return m};b.get_closest_colliders=function(h){var i=this.find_collisions(h);i.sort(function(k,j){if(k.region==="C"&&j.region==="C"){if(k.coords.y1<j.coords.y1||k.coords.x1<j.coords.x1){return -1}else{return 1}}if(k.area<j.area){return 1}return 1});return i};d.fn.collision=function(i,h){return new g(this,i,h)}}(jQuery,window,document));(function(a,b){a.delay=function(d,e){var c=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return d.apply(null,c)},e)};a.debounce=function(d,f,c){var e;return function(){var i=this,h=arguments;var g=function(){e=null;if(!c){d.apply(i,h)}};if(c&&!e){d.apply(i,h)}clearTimeout(e);e=setTimeout(g,f)}};a.throttle=function(e,f){var d,h,i,j,g,k;var c=debounce(function(){g=j=false},f);return function(){d=this;h=arguments;var l=function(){i=null;if(g){e.apply(d,h)}c()};if(!i){i=setTimeout(l,f)}if(j){g=true}else{k=e.apply(d,h)}c();j=true;return k}}})(window);(function(f,h,i,c){var d={items:"li",distance:1,limit:true,offset_left:0,autoscroll:true,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:true,helper:false};var b=f(h);var e=!!("ontouchstart" in h);var g={start:e?"touchstart.gridster-draggable":"mousedown.gridster-draggable",move:e?"touchmove.gridster-draggable":"mousemove.gridster-draggable",end:e?"touchend.gridster-draggable":"mouseup.gridster-draggable"};function a(l,k){this.options=f.extend({},d,k);this.$body=f(i.body);this.$container=f(l);this.$dragitems=f(this.options.items,this.$container);this.is_dragging=false;this.player_min_left=0+this.options.offset_left;this.init()}var j=a.prototype;j.init=function(){this.calculate_positions();this.$container.css("position","relative");this.disabled=false;this.events();f(h).bind("resize.gridster-draggable",throttle(f.proxy(this.calculate_positions,this),200))};j.events=function(){this.$container.on("selectstart.gridster-draggable",f.proxy(this.on_select_start,this));this.$container.on(g.start,this.options.items,f.proxy(this.drag_handler,this));this.$body.on(g.end,f.proxy(function(k){this.is_dragging=false;if(this.disabled){return}this.$body.off(g.move);if(this.drag_start){this.on_dragstop(k)}},this))};j.get_actual_pos=function(k){var l=k.position();return l};j.get_mouse_pos=function(k){if(e){var l=k.originalEvent;k=l.touches.length?l.touches[0]:l.changedTouches[0]}return{left:k.clientX,top:k.clientY}};j.get_offset=function(p){p.preventDefault();var k=this.get_mouse_pos(p);var o=Math.round(k.left-this.mouse_init_pos.left);var l=Math.round(k.top-this.mouse_init_pos.top);var n=Math.round(this.el_init_offset.left+o-this.baseX);var m=Math.round(this.el_init_offset.top+l-this.baseY+this.scrollOffset);if(this.options.limit){if(n>this.player_max_left){n=this.player_max_left}else{if(n<this.player_min_left){n=this.player_min_left}}}return{position:{left:n,top:m},pointer:{left:k.left,top:k.top,diff_left:o,diff_top:l+this.scrollOffset}}};j.get_drag_data=function(k){var l=this.get_offset(k);l.$player=this.$player;l.$helper=this.helper?this.$helper:this.$player;return l};j.manage_scroll=function(p){var t;var m=b.scrollTop();var s=m;var r=s+this.window_height;var l=r-50;var k=s+50;var o=p.pointer.left;var q=s+p.pointer.top;var n=(this.doc_height-this.window_height+this.player_height);if(q>=l){t=m+30;if(t<n){b.scrollTop(t);this.scrollOffset=this.scrollOffset+30}}if(q<=k){t=m-30;if(t>0){b.scrollTop(t);this.scrollOffset=this.scrollOffset-30}}};j.calculate_positions=function(k){this.window_height=b.height()};j.drag_handler=function(m){var l=m.target.nodeName;if(this.disabled||m.which!==1&&!e){return}if(this.ignore_drag(m)){return}var k=this;var n=true;this.$player=f(m.currentTarget);this.el_init_pos=this.get_actual_pos(this.$player);this.mouse_init_pos=this.get_mouse_pos(m);this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top;this.$body.on(g.move,function(r){var o=k.get_mouse_pos(r);var q=Math.abs(o.left-k.mouse_init_pos.left);var p=Math.abs(o.top-k.mouse_init_pos.top);if(!(q>k.options.distance||p>k.options.distance)){return false}if(n){n=false;k.on_dragstart.call(k,r);return false}if(k.is_dragging===true){k.on_dragmove.call(k,r)}return false});if(!e){return false}};j.on_dragstart=function(l){l.preventDefault();if(this.is_dragging){return this}this.drag_start=this.is_dragging=true;var m=this.$container.offset();this.baseX=Math.round(m.left);this.baseY=Math.round(m.top);this.doc_height=f(i).height();if(this.options.helper==="clone"){this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper");this.helper=true}else{this.helper=false}this.scrollOffset=0;this.el_init_offset=this.$player.offset();this.player_width=this.$player.width();this.player_height=this.$player.height();var k=this.options.container_width||this.$container.width();this.player_max_left=(k-this.player_width+this.options.offset_left);if(this.options.start){this.options.start.call(this.$player,l,this.get_drag_data(l))}return false};j.on_dragmove=function(l){var k=this.get_drag_data(l);this.options.autoscroll&&this.manage_scroll(k);if(this.options.move_element){(this.helper?this.$helper:this.$player).css({position:"absolute",left:k.position.left,top:k.position.top})}var m=this.last_position||k.position;k.prev_position=m;if(this.options.drag){this.options.drag.call(this.$player,l,k)}this.last_position=k.position;return false};j.on_dragstop=function(l){var k=this.get_drag_data(l);this.drag_start=false;if(this.options.stop){this.options.stop.call(this.$player,l,k)}if(this.helper){this.$helper.remove()}return false};j.on_select_start=function(k){if(this.disabled){return}if(this.ignore_drag(k)){return}return false};j.enable=function(){this.disabled=false};j.disable=function(){this.disabled=true};j.destroy=function(){this.disable();this.$container.off(".gridster-draggable");this.$body.off(".gridster-draggable");f(h).off(".gridster-draggable");f.removeData(this.$container,"drag")};j.ignore_drag=function(k){if(this.options.handle){return !f(k.target).is(this.options.handle)}return f(k.target).is(this.options.ignore_dragging.join(", "))};f.fn.drag=function(k){return new a(this,k)}}(jQuery,window,document));(function(e,d,a,g){var f={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:null,min_rows:15,max_size_x:false,autogenerate_stylesheet:true,avoid_overlapped_widgets:true,serialize_params:function(i,h){return{col:h.col,row:h.row,size_x:h.size_x,size_y:h.size_y}},collision:{},draggable:{items:".gs-w",distance:4},resize:{enabled:false,axes:["x","y","both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[Infinity,Infinity]}};function c(i,h){this.options=e.extend(true,f,h);this.$el=e(i);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w");this.widgets=[];this.$changed=e([]);this.wrapper_width=this.$wrapper.width();this.min_widget_width=(this.options.widget_margins[0]*2)+this.options.widget_base_dimensions[0];this.min_widget_height=(this.options.widget_margins[1]*2)+this.options.widget_base_dimensions[1];this.$style_tags=e([]);this.init()}c.generated_stylesheets=[];var b=c.prototype;b.init=function(){this.options.resize.enabled&&this.setup_resize();this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.$wrapper.addClass("ready");this.draggable();this.options.resize.enabled&&this.resizable();e(d).bind("resize.gridster",throttle(e.proxy(this.recalculate_faux_grid,this),200))};b.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};b.enable=function(){this.drag_api.enable();return this};b.disable_resize=function(){this.$el.addClass("gs-resize-disabled");this.resize_api.disable();return this};b.enable_resize=function(){this.$el.removeClass("gs-resize-disabled");this.resize_api.enable();return this};b.add_widget=function(k,j,h,i,n,m){var o;j||(j=1);h||(h=1);if(!i&!n){o=this.next_position(j,h)}else{o={col:i,row:n};this.empty_cells(i,n,j,h)}var l=e(k).attr({"data-col":o.col,"data-row":o.row,"data-sizex":j,"data-sizey":h}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(l);this.register_widget(l);this.add_faux_rows(o.size_y);if(m){this.set_widget_max_size(l,m)}this.set_dom_grid_height();return l.fadeIn()};b.set_widget_max_size=function(j,i){j=typeof j==="number"?this.$widgets.eq(j):j;if(!j.length){return this}var h=j.data("coords").grid;h.max_size_x=i[0];h.max_size_y=i[1];return this};b.add_resize_handle=function(h){var i=this.options.resize.handle_append_to;e(this.resize_handle_tpl).appendTo(i?e(i,h):h);return this};b.resize_widget=function(h,s,r,o,q){var l=h.coords().grid;o!==false&&(o=true);s||(s=l.size_x);r||(r=l.size_y);if(s>this.cols){s=this.cols}var m=l.size_y;var i=l.col;var j=i;if(o&&i+s-1>this.cols){var n=i+(s-1)-this.cols;var k=i-n;j=Math.max(1,k)}if(r>m){this.add_faux_rows(Math.max(r-m,0))}var p={col:j,row:l.row,size_x:s,size_y:r};this.mutate_widget_in_gridmap(h,l,p);this.set_dom_grid_height();if(q){q.call(this,p.size_x,p.size_y)}return h};b.mutate_widget_in_gridmap=function(h,o,j){var t=o.size_x;var r=o.size_y;var u=this.get_cells_occupied(o);var m=this.get_cells_occupied(j);var i=[];e.each(u.cols,function(x,w){if(e.inArray(w,m.cols)===-1){i.push(w)}});var n=[];e.each(m.cols,function(x,w){if(e.inArray(w,u.cols)===-1){n.push(w)}});var l=[];e.each(u.rows,function(w,x){if(e.inArray(x,m.rows)===-1){l.push(x)}});var q=[];e.each(m.rows,function(w,x){if(e.inArray(x,u.rows)===-1){q.push(x)}});this.remove_from_gridmap(o);if(n.length){var k=[j.col,j.row,j.size_x,Math.min(r,j.size_y),h];this.empty_cells.apply(this,k)}if(q.length){var v=[j.col,j.row,j.size_x,j.size_y,h];this.empty_cells.apply(this,v)}o.col=j.col;o.row=j.row;o.size_x=j.size_x;o.size_y=j.size_y;this.add_to_gridmap(j,h);h.removeClass("player-revert");h.data("coords").update({width:(j.size_x*this.options.widget_base_dimensions[0]+((j.size_x-1)*this.options.widget_margins[0])*2),height:(j.size_y*this.options.widget_base_dimensions[1]+((j.size_y-1)*this.options.widget_margins[1])*2)});h.attr({"data-col":j.col,"data-row":j.row,"data-sizex":j.size_x,"data-sizey":j.size_y});if(i.length){var p=[i[0],j.row,i.length,Math.min(r,j.size_y),h];this.remove_empty_cells.apply(this,p)}if(l.length){var s=[j.col,j.row,j.size_x,j.size_y,h];this.remove_empty_cells.apply(this,s)}this.move_widget_up(h);return this};b.empty_cells=function(k,l,j,i,m){var h=this.widgets_below({col:k,row:l-i,size_x:j,size_y:i});h.not(m).each(e.proxy(function(p,n){var o=e(n).coords().grid;if(!(o.row<=(l+i-1))){return}var q=(l+i)-o.row;this.move_widget_down(e(n),q)},this));this.set_dom_grid_height();return this};b.remove_empty_cells=function(l,m,k,j,i){var h=this.widgets_below({col:l,row:m,size_x:k,size_y:j});h.not(i).each(e.proxy(function(n,o){this.move_widget_up(e(o),j)},this));this.set_dom_grid_height();return this};b.next_position=function(p,o){p||(p=1);o||(o=1);var n=this.gridmap;var m=n.length;var l=[];var i;for(var k=1;k<m;k++){i=n[k].length;for(var h=1;h<=i;h++){var j=this.can_move_to({size_x:p,size_y:o},k,h);if(j){l.push({col:k,row:h,size_y:o,size_x:p})}}}if(l.length){return this.sort_by_row_and_col_asc(l)[0]}return false};b.remove_widget=function(l,i,m){var k=l instanceof jQuery?l:e(l);var j=k.coords().grid;if(e.isFunction(i)){m=i;i=false}this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(k);var h=this.widgets_below(k);this.remove_from_gridmap(j);k.fadeOut(e.proxy(function(){k.remove();if(!i){h.each(e.proxy(function(n,o){this.move_widget_up(e(o),j.size_y)},this))}this.set_dom_grid_height();if(m){m.call(this,l)}},this));return this};b.remove_all_widgets=function(h){this.$widgets.each(e.proxy(function(j,k){this.remove_widget(k,true,h)},this));return this};b.serialize=function(i){i||(i=this.$widgets);var h=[];i.each(e.proxy(function(j,k){h.push(this.options.serialize_params(e(k),e(k).coords().grid))},this));return h};b.serialize_changed=function(){return this.serialize(this.$changed)};b.register_widget=function(i){var h={col:parseInt(i.attr("data-col"),10),row:parseInt(i.attr("data-row"),10),size_x:parseInt(i.attr("data-sizex"),10),size_y:parseInt(i.attr("data-sizey"),10),max_size_x:parseInt(i.attr("data-max-sizex"),10)||false,max_size_y:parseInt(i.attr("data-max-sizey"),10)||false,el:i};if(this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:h.size_x,size_y:h.size_y},h.col,h.row)){e.extend(h,this.next_position(h.size_x,h.size_y));i.attr({"data-col":h.col,"data-row":h.row,"data-sizex":h.size_x,"data-sizey":h.size_y})}i.data("coords",i.coords());i.data("coords").grid=h;this.add_to_gridmap(h,i);this.options.resize.enabled&&this.add_resize_handle(i);return this};b.update_widget_position=function(h,i){this.for_each_cell_occupied(h,function(j,k){if(!this.gridmap[j]){return this}this.gridmap[j][k]=i});return this};b.remove_from_gridmap=function(h){return this.update_widget_position(h,false)};b.add_to_gridmap=function(i,j){this.update_widget_position(i,j||i.el);if(i.el){var h=this.widgets_below(i.el);h.each(e.proxy(function(k,l){this.move_widget_up(e(l))},this))}};b.draggable=function(){var h=this;var i=e.extend(true,{},this.options.draggable,{offset_left:this.options.widget_margins[0],container_width:this.container_width,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON","."+this.options.resize.handle_class],start:function(j,k){h.$widgets.filter(".player-revert").removeClass("player-revert");h.$player=e(this);h.$helper=e(k.$helper);h.helper=!h.$helper.is(h.$player);h.on_start_drag.call(h,j,k);h.$el.trigger("gridster:dragstart")},stop:function(j,k){h.on_stop_drag.call(h,j,k);h.$el.trigger("gridster:dragstop")},drag:throttle(function(j,k){h.on_drag.call(h,j,k);h.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.drag(i);return this};b.resizable=function(){this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:false,start:e.proxy(this.on_start_resize,this),stop:e.proxy(function(h,i){delay(e.proxy(function(){this.on_stop_resize(h,i)},this),120)},this),drag:throttle(e.proxy(this.on_resize,this),60)});return this};b.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var i=this.options.resize.axes;var h='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';this.resize_handle_tpl=e.map(i,function(j){return h.replace("{type}",j)}).join("");return this};b.on_start_drag=function(i,k){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=e.extend({},this.player_grid_data);this.$el.css("height",this.$el.height()+(this.player_grid_data.size_y*this.min_widget_height));var h=this.faux_grid;var j=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(h,this.options.collision);this.$preview_holder=e("<"+this.$player.get(0).tagName+" />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:j.width,height:j.height}}).appendTo(this.$el);if(this.options.draggable.start){this.options.draggable.start.call(this,i,k)}};b.on_drag=function(i,j){if(this.$player===null){return false}var h={left:j.position.left+this.baseX,top:j.position.top+this.baseY};this.colliders_data=this.collision_api.get_closest_colliders(h);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);if(this.helper&&this.$player){this.$player.css({left:j.position.left,top:j.position.top})}if(this.options.draggable.drag){this.options.draggable.drag.call(this,i,j)}};b.on_stop_drag=function(h,i){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");i.position.left=i.position.left+this.baseX;i.position.top=i.position.top+this.baseY;this.colliders_data=this.collision_api.get_closest_colliders(i.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""});this.$changed=this.$changed.add(this.$player);this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row);this.$player.coords().grid.row=this.placeholder_grid_data.row;this.$player.coords().grid.col=this.placeholder_grid_data.col;if(this.options.draggable.stop){this.options.draggable.stop.call(this,h,i)}this.$preview_holder.remove();this.$player=null;this.$helper=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.set_dom_grid_height()};b.on_start_resize=function(h,i){this.$resized_widget=i.$player.closest(".gs-w");this.resize_coords=this.$resized_widget.coords();this.resize_wgd=this.resize_coords.grid;this.resize_initial_width=this.resize_coords.coords.width;this.resize_initial_height=this.resize_coords.coords.height;this.resize_initial_sizex=this.resize_coords.grid.size_x;this.resize_initial_sizey=this.resize_coords.grid.size_y;this.resize_last_sizex=this.resize_initial_sizex;this.resize_last_sizey=this.resize_initial_sizey;this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.cols-this.resize_wgd.col+1);this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1];this.resize_dir={right:i.$player.is("."+this.resize_handle_class+"-x"),bottom:i.$player.is("."+this.resize_handle_class+"-y")};this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var j=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=e("<"+j+" />",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el);this.$resized_widget.addClass("resizing");if(this.options.resize.start){this.options.resize.start.call(this,h,i,this.$resized_widget)}};b.on_stop_resize=function(h,i){this.$resized_widget.removeClass("resizing").css({width:"",height:""});delay(e.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""})},this),300);if(this.options.resize.stop){this.options.resize.stop.call(this,h,i,this.$resized_widget)}};b.on_resize=function(h,m){var q=(m.pointer.diff_left);var n=(m.pointer.diff_top);var k=this.options.widget_base_dimensions[0];var j=this.options.widget_base_dimensions[1];var t=Infinity;var l=Infinity;var s=Math.ceil((q/(this.options.widget_base_dimensions[0]+this.options.widget_margins[0]*2))-0.2);var p=Math.ceil((n/(this.options.widget_base_dimensions[1]+this.options.widget_margins[1]*2))-0.2);var r=Math.max(1,this.resize_initial_sizex+s);var o=Math.max(1,this.resize_initial_sizey+p);r=Math.min(r,this.resize_max_size_x);t=(this.resize_max_size_x*k)+((r-1)*this.options.widget_margins[0]*2);o=Math.min(o,this.resize_max_size_y);l=(this.resize_max_size_y*j)+((o-1)*this.options.widget_margins[1]*2);if(this.resize_dir.right){o=this.resize_initial_sizey}else{if(this.resize_dir.bottom){r=this.resize_initial_sizex}}var i={};!this.resize_dir.bottom&&(i.width=Math.min(this.resize_initial_width+q,t));!this.resize_dir.right&&(i.height=Math.min(this.resize_initial_height+n,l));this.$resized_widget.css(i);if(r!==this.resize_last_sizex||o!==this.resize_last_sizey){this.resize_widget(this.$resized_widget,r,o,false);this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":r,"data-sizey":o})}if(this.options.resize.resize){this.options.resize.resize.call(this,h,m,this.$resized_widget)}this.resize_last_sizex=r;this.resize_last_sizey=o};b.on_overlapped_column_change=function(j,n){if(!this.colliders_data.length){return this}var l=this.get_targeted_columns(this.colliders_data[0].el.data.col);var m=this.last_cols.length;var k=l.length;var h;for(h=0;h<k;h++){if(e.inArray(l[h],this.last_cols)===-1){(j||e.noop).call(this,l[h])}}for(h=0;h<m;h++){if(e.inArray(this.last_cols[h],l)===-1){(n||e.noop).call(this,this.last_cols[h])}}this.last_cols=l;return this};b.on_overlapped_row_change=function(j,k){if(!this.colliders_data.length){return this}var m=this.get_targeted_rows(this.colliders_data[0].el.data.row);var n=this.last_rows.length;var l=m.length;var h;for(h=0;h<l;h++){if(e.inArray(m[h],this.last_rows)===-1){(j||e.noop).call(this,m[h])}}for(h=0;h<n;h++){if(e.inArray(this.last_rows[h],m)===-1){(k||e.noop).call(this,this.last_rows[h])}}this.last_rows=m};b.set_player=function(k,q,h){var p=this;if(!h){this.empty_cells_player_occupies()}var o=!h?p.colliders_data[0].el.data:{col:k};var m=o.col;var i=q||o.row;this.player_grid_data={col:m,row:i,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var n=this.get_widgets_overlapped(this.player_grid_data);var l=this.widgets_constraints(n);this.manage_movements(l.can_go_up,m,i);this.manage_movements(l.can_not_go_up,m,i);if(!n.length){var j=this.can_go_player_up(this.player_grid_data);if(j!==false){i=j}this.set_placeholder(m,i)}return{col:m,row:i}};b.widgets_constraints=function(i){var h=e([]);var k;var j=[];var l=[];i.each(e.proxy(function(o,m){var p=e(m);var n=p.coords().grid;if(this.can_go_widget_up(n)){h=h.add(p);j.push(n)}else{l.push(n)}},this));k=i.not(h);return{can_go_up:this.sort_by_row_asc(j),can_not_go_up:this.sort_by_row_desc(l)}};b.sort_by_row_asc=function(h){h=h.sort(function(j,i){if(!j.row){j=e(j).coords().grid;i=e(i).coords().grid}if(j.row>i.row){return 1}return -1});return h};b.sort_by_row_and_col_asc=function(h){h=h.sort(function(j,i){if(j.row>i.row||j.row===i.row&&j.col>i.col){return 1}return -1});return h};b.sort_by_col_asc=function(h){h=h.sort(function(j,i){if(j.col>i.col){return 1}return -1});return h};b.sort_by_row_desc=function(h){h=h.sort(function(j,i){if(j.row+j.size_y<i.row+i.size_y){return 1}return -1});return h};b.manage_movements=function(i,j,h){e.each(i,e.proxy(function(n,l){var m=l;var p=m.el;var k=this.can_go_widget_up(m);if(k){this.move_widget_to(p,k);this.set_placeholder(j,k+m.size_y)}else{var o=this.can_go_player_up(this.player_grid_data);if(!o){var q=(h+this.player_grid_data.size_y)-m.row;this.move_widget_down(p,q);this.set_placeholder(j,h)}}},this));return this};b.is_player=function(i,j){if(j&&!this.gridmap[i]){return false}var h=j?this.gridmap[i][j]:i;return h&&(h.is(this.$player)||h.is(this.$helper))};b.is_player_in=function(h,i){var j=this.cells_occupied_by_player||{};return e.inArray(h,j.cols)>=0&&e.inArray(i,j.rows)>=0};b.is_placeholder_in=function(h,i){var j=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(h)&&e.inArray(i,j.rows)>=0};b.is_placeholder_in_col=function(h){var i=this.cells_occupied_by_placeholder||[];return e.inArray(h,i.cols)>=0};b.is_empty=function(h,i){if(typeof this.gridmap[h]!=="undefined"){if(typeof this.gridmap[h][i]!=="undefined"&&this.gridmap[h][i]===false){return true}return false}return true};b.is_occupied=function(h,i){if(!this.gridmap[h]){return false}if(this.gridmap[h][i]){return true}return false};b.is_widget=function(i,j){var h=this.gridmap[i];if(!h){return false}h=h[j];if(h){return h}return false};b.is_widget_under_player=function(h,i){if(this.is_widget(h,i)){return this.is_player_in(h,i)}return false};b.get_widgets_under_player=function(i){i||(i=this.cells_occupied_by_player||{cols:[],rows:[]});var h=e([]);e.each(i.cols,e.proxy(function(k,j){e.each(i.rows,e.proxy(function(l,m){if(this.is_widget(j,m)){h=h.add(this.gridmap[j][m])}},this))},this));return h};b.set_placeholder=function(k,n){var j=e.extend({},this.placeholder_grid_data);var h=this.widgets_below({col:j.col,row:j.row,size_y:j.size_y,size_x:j.size_x});var i=(k+j.size_x-1);if(i>this.cols){k=k-(i-k)}var o=this.placeholder_grid_data.row<n;var l=this.placeholder_grid_data.col!==k;this.placeholder_grid_data.col=k;this.placeholder_grid_data.row=n;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":n,"data-col":k});if(o||l){h.each(e.proxy(function(p,q){this.move_widget_up(e(q),this.placeholder_grid_data.col-k+j.size_y)},this))}var m=this.get_widgets_under_player(this.cells_occupied_by_placeholder);if(m.length){m.each(e.proxy(function(p,r){var q=e(r);this.move_widget_down(q,n+j.size_y-q.data("coords").grid.row)},this))}};b.can_go_player_up=function(m){var j=m.row+m.size_y-1;var h=true;var i=[];var l=10000;var k=this.get_widgets_under_player();this.for_each_column_occupied(m,function(p){var n=this.gridmap[p];var o=j+1;i[p]=[];while(--o>0){if(this.is_empty(p,o)||this.is_player(p,o)||this.is_widget(p,o)&&n[o].is(k)){i[p].push(o);l=o<l?o:l}else{break}}if(i[p].length===0){h=false;return true}i[p].sort(function(r,q){return r-q})});if(!h){return false}return this.get_valid_rows(m,i,l)};b.can_go_widget_up=function(l){var j=l.row+l.size_y-1;var h=true;var i=[];var k=10000;this.for_each_column_occupied(l,function(o){var m=this.gridmap[o];i[o]=[];var n=j+1;while(--n>0){if(this.is_widget(o,n)&&!this.is_player_in(o,n)){if(!m[n].is(l.el)){break}}if(!this.is_player(o,n)&&!this.is_placeholder_in(o,n)&&!this.is_player_in(o,n)){i[o].push(n)}if(n<k){k=n}}if(i[o].length===0){h=false;return true}i[o].sort(function(q,p){return q-p})});if(!h){return false}return this.get_valid_rows(l,i,k)};b.get_valid_rows=function(i,q,p){var n=i.row;var l=i.row+i.size_y-1;var o=i.size_y;var h=p-1;var j=[];while(++h<=l){var m=true;e.each(q,function(r,s){if(e.isArray(s)&&e.inArray(h,s)===-1){m=false}});if(m===true){j.push(h);if(j.length===o){break}}}var k=false;if(o===1){if(j[0]!==n){k=j[0]||false}}else{if(j[0]!==n){k=this.get_consecutive_numbers_index(j,o)}}return k};b.get_consecutive_numbers_index=function(k,l){var j=k.length;var h=[];var o=true;var n=-1;for(var m=0;m<j;m++){if(o||k[m]===n+1){h.push(m);if(h.length===l){break}o=false}else{h=[];o=true}n=k[m]}return h.length>=l?k[h[0]]:false};b.get_widgets_overlapped=function(){var k;var h=e([]);var j=[];var i=this.cells_occupied_by_player.rows.slice(0);i.reverse();e.each(this.cells_occupied_by_player.cols,e.proxy(function(m,l){e.each(i,e.proxy(function(n,p){if(!this.gridmap[l]){return true}var o=this.gridmap[l][p];if(this.is_occupied(l,p)&&!this.is_player(o)&&e.inArray(o,j)===-1){h=h.add(o);j.push(o)}},this))},this));return h};b.on_start_overlapping_column=function(h){this.set_player(h,false)};b.on_start_overlapping_row=function(h){this.set_player(false,h)};b.on_stop_overlapping_column=function(i){this.set_player(i,false);var h=this;this.for_each_widget_below(i,this.cells_occupied_by_player.rows[0],function(k,j){h.move_widget_up(this,h.player_grid_data.size_y)})};b.on_stop_overlapping_row=function(k){this.set_player(false,k);var i=this;var j=this.cells_occupied_by_player.cols;for(var l=0,h=j.length;l<h;l++){this.for_each_widget_below(j[l],k,function(n,m){i.move_widget_up(this,i.player_grid_data.size_y)})}};b.move_widget_to=function(n,m){var h=this;var j=n.coords().grid;var l=m-j.row;var k=this.widgets_below(n);var i=this.can_move_to(j,j.col,m,n);if(i===false){return false}this.remove_from_gridmap(j);j.row=m;this.add_to_gridmap(j);n.attr("data-row",m);this.$changed=this.$changed.add(n);k.each(function(p,r){var q=e(r);var o=q.coords().grid;var s=h.can_go_widget_up(o);if(s&&s!==o.row){h.move_widget_to(q,s)}});return this};b.move_widget_up=function(m,l){var k=m.coords().grid;var h=k.row;var i=[];var j=true;l||(l=1);if(!this.can_go_up(m)){return false}this.for_each_column_occupied(k,function(n){if(e.inArray(m,i)===-1){var o=m.coords().grid;var p=h-l;p=this.can_go_up_to_row(o,n,p);if(!p){return true}var q=this.widgets_below(m);this.remove_from_gridmap(o);o.row=p;this.add_to_gridmap(o);m.attr("data-row",o.row);this.$changed=this.$changed.add(m);i.push(m);q.each(e.proxy(function(r,s){this.move_widget_up(e(s),l)},this))}})};b.move_widget_down=function(h,l){var i,o,n,m;if(l<=0){return false}i=h.coords().grid;o=i.row;n=[];m=l;if(!h){return false}if(e.inArray(h,n)===-1){var k=h.coords().grid;var p=o+l;var j=this.widgets_below(h);this.remove_from_gridmap(k);j.each(e.proxy(function(r,u){var t=e(u);var s=t.coords().grid;var q=this.displacement_diff(s,k,m);if(q>0){this.move_widget_down(t,q)}},this));k.row=p;this.update_widget_position(k,h);h.attr("data-row",k.row);this.$changed=this.$changed.add(h);n.push(h)}};b.can_go_up_to_row=function(j,i,q){var o=this.gridmap;var s=true;var l=[];var n=j.row;var h;this.for_each_column_occupied(j,function(t){var r=o[t];l[t]=[];h=n;while(h--){if(this.is_empty(t,h)&&!this.is_placeholder_in(t,h)){l[t].push(h)}else{break}}if(!l[t].length){s=false;return true}});if(!s){return false}h=q;for(h=1;h<n;h++){var m=true;for(var p=0,k=l.length;p<k;p++){if(l[p]&&e.inArray(h,l[p])===-1){m=false}}if(m===true){s=h;break}}return s};b.displacement_diff=function(k,l,n){var i=k.row;var m=[];var j=l.row+l.size_y;this.for_each_column_occupied(k,function(o){var q=0;for(var p=j;p<i;p++){if(this.is_empty(o,p)){q=q+1}}m.push(q)});var h=Math.max.apply(Math,m);n=(n-h);return n>0?n:0};b.widgets_below=function(j){var l=e.isPlainObject(j)?j:j.coords().grid;var i=this;var m=this.gridmap;var k=l.row+l.size_y-1;var h=e([]);this.for_each_column_occupied(l,function(n){i.for_each_widget_below(n,k,function(p,o){if(!i.is_player(this)&&e.inArray(this,h)===-1){h=h.add(this);return true}})});return this.sort_by_row_asc(h)};b.set_cells_player_occupies=function(h,i){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=h;this.placeholder_grid_data.row=i;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};b.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};b.can_go_up=function(j){var m=j.coords().grid;var k=m.row;var l=k-1;var n=this.gridmap;var i=[];var h=true;if(k===1){return false}this.for_each_column_occupied(m,function(o){var p=this.is_widget(o,l);if(this.is_occupied(o,l)||this.is_player(o,l)||this.is_placeholder_in(o,l)||this.is_player_in(o,l)){h=false;return true}});return h};b.can_move_to=function(i,h,o,m){var n=this.gridmap;var j=i.el;var k={size_y:i.size_y,size_x:i.size_x,col:h,row:o};var p=true;var l=h+i.size_x-1;if(l>this.cols){return false}if(m&&m<o+i.size_y-1){return false}this.for_each_cell_occupied(k,function(s,r){var q=this.is_widget(s,r);if(q&&(!i.el||q.is(j))){p=false}});return p};b.get_targeted_columns=function(k){var h=(k||this.player_grid_data.col)+(this.player_grid_data.size_x-1);var j=[];for(var i=k;i<=h;i++){j.push(i)}return j};b.get_targeted_rows=function(i){var h=(i||this.player_grid_data.row)+(this.player_grid_data.size_y-1);var j=[];for(var k=i;k<=h;k++){j.push(k)}return j};b.get_cells_occupied=function(l){var j={cols:[],rows:[]};var k;if(arguments[1] instanceof jQuery){l=arguments[1].coords().grid}for(k=0;k<l.size_x;k++){var h=l.col+k;j.cols.push(h)}for(k=0;k<l.size_y;k++){var m=l.row+k;j.rows.push(m)}return j};b.for_each_cell_occupied=function(h,i){this.for_each_column_occupied(h,function(j){this.for_each_row_occupied(h,function(k){i.call(this,j,k)})});return this};b.for_each_column_occupied=function(k,l){for(var j=0;j<k.size_x;j++){var h=k.col+j;l.call(this,h,k)}};b.for_each_row_occupied=function(j,l){for(var h=0;h<j.size_y;h++){var k=j.row+h;l.call(this,k,j)}};b._traversing_widgets=function(n,q,j,t,r){var s=this.gridmap;if(!s[j]){return}var m,p;var l=n+"/"+q;if(arguments[2] instanceof jQuery){var h=arguments[2].coords().grid;j=h.col;t=h.row;r=arguments[3]}var i=[];var o=t;var k={"for_each/above":function(){while(o--){if(o>0&&this.is_widget(j,o)&&e.inArray(s[j][o],i)===-1){m=r.call(s[j][o],j,o);i.push(s[j][o]);if(m){break}}}},"for_each/below":function(){for(o=t+1,p=s[j].length;o<p;o++){if(this.is_widget(j,o)&&e.inArray(s[j][o],i)===-1){m=r.call(s[j][o],j,o);i.push(s[j][o]);if(m){break}}}}};if(k[l]){k[l].call(this)}};b.for_each_widget_above=function(h,i,j){this._traversing_widgets("for_each","above",h,i,j);return this};b.for_each_widget_below=function(h,i,j){this._traversing_widgets("for_each","below",h,i,j);return this};b.get_highest_occupied_cell=function(){var i;var k=this.gridmap;var j=[];var m=[];for(var l=k.length-1;l>=1;l--){for(i=k[l].length-1;i>=1;i--){if(this.is_widget(l,i)){j.push(i);m[i]=l;break}}}var h=Math.max.apply(Math,j);this.highest_occupied_cell={col:m[h],row:h};return this.highest_occupied_cell};b.get_widgets_from=function(i,k){var j=this.gridmap;var h=e();if(i){h=h.add(this.$widgets.filter(function(){var l=e(this).attr("data-col");return(l===i||l>i)}))}if(k){h=h.add(this.$widgets.filter(function(){var l=e(this).attr("data-row");return(l===k||l>k)}))}return h};b.set_dom_grid_height=function(){var h=this.get_highest_occupied_cell().row;this.$el.css("height",h*this.min_widget_height);return this};b.generate_stylesheet=function(h){var r="";var o=this.options.max_size_x||this.cols;var m=0;var l=0;var k;var q;h||(h={});h.cols||(h.cols=this.cols);h.rows||(h.rows=this.rows);h.namespace||(h.namespace=this.options.namespace);h.widget_base_dimensions||(h.widget_base_dimensions=this.options.widget_base_dimensions);h.widget_margins||(h.widget_margins=this.options.widget_margins);h.min_widget_width=(h.widget_margins[0]*2)+h.widget_base_dimensions[0];h.min_widget_height=(h.widget_margins[1]*2)+h.widget_base_dimensions[1];var j=e.param(h);if(e.inArray(j,c.generated_stylesheets)>=0){}c.generated_stylesheets.push(j);for(k=h.cols;k>=0;k--){r+=(h.namespace+' [data-col="'+(k+1)+'"] { left:'+((k*h.widget_base_dimensions[0])+(k*h.widget_margins[0])+((k+1)*h.widget_margins[0]))+"px; }\n")}for(k=h.rows;k>=0;k--){r+=(h.namespace+' [data-row="'+(k+1)+'"] { top:'+((k*h.widget_base_dimensions[1])+(k*h.widget_margins[1])+((k+1)*h.widget_margins[1]))+"px; }\n")}for(var n=1;n<=h.rows;n++){r+=(h.namespace+' [data-sizey="'+n+'"] { height:'+(n*h.widget_base_dimensions[1]+(n-1)*(h.widget_margins[1]*2))+"px; }\n")}for(var p=1;p<=o;p++){r+=(h.namespace+' [data-sizex="'+p+'"] { width:'+(p*h.widget_base_dimensions[0]+(p-1)*(h.widget_margins[0]*2))+"px; }\n")}return this.add_style_tag(r)};b.add_style_tag=function(i){var j=a;var h=j.createElement("style");j.getElementsByTagName("head")[0].appendChild(h);h.setAttribute("type","text/css");if(h.styleSheet){h.styleSheet.cssText=i}else{h.appendChild(a.createTextNode(i))}this.$style_tags=this.$style_tags.add(h);return this};b.remove_style_tags=function(){this.$style_tags.remove()};b.generate_faux_grid=function(i,j){this.faux_grid=[];this.gridmap=[];var h;var k;for(h=j;h>0;h--){this.gridmap[h]=[];for(k=i;k>0;k--){this.add_faux_cell(k,h)}}return this};b.add_faux_cell=function(j,h){var i=e({left:this.baseX+((h-1)*this.min_widget_width),top:this.baseY+(j-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:h,row:j,original_col:h,original_row:j}).coords();if(!e.isArray(this.gridmap[h])){this.gridmap[h]=[]}this.gridmap[h][j]=false;this.faux_grid.push(i);return this};b.add_faux_rows=function(k){var i=this.rows;var h=i+(k||1);for(var j=h;j>i;j--){for(var l=this.cols;l>=1;l--){this.add_faux_cell(j,l)}}this.rows=h;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};b.add_faux_cols=function(k){var i=this.cols;var h=i+(k||1);for(var l=i;l<h;l++){for(var j=this.rows;j>=1;j--){this.add_faux_cell(j,l)}}this.cols=h;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};b.recalculate_faux_grid=function(){var h=this.$wrapper.width();this.baseX=(e(d).width()-h)/2;this.baseY=this.$wrapper.offset().top;e.each(this.faux_grid,e.proxy(function(j,k){this.faux_grid[j]=k.update({left:this.baseX+(k.data.col-1)*this.min_widget_width,top:this.baseY+(k.data.row-1)*this.min_widget_height})},this));return this};b.get_widgets_from_DOM=function(){this.$widgets.each(e.proxy(function(h,j){this.register_widget(e(j))},this));return this};b.generate_grid_and_stylesheet=function(){var n=this.$wrapper.width();var k=this.$wrapper.height();var j=this.options.max_cols;var m=Math.floor(n/this.min_widget_width)+this.options.extra_cols;var l=this.$widgets.map(function(){return e(this).attr("data-col")}).get();l.length||(l=[0]);var i=Math.max.apply(Math,l);var h=this.options.extra_rows;this.$widgets.each(function(p,o){h+=(+e(o).attr("data-sizey"))});this.cols=Math.max(i,m,this.options.min_cols);if(j&&j>=i&&j<this.cols){this.cols=j}this.rows=Math.max(h,this.options.min_rows);this.baseX=(e(d).width()-n)/2;this.baseY=this.$wrapper.offset().top;this.container_width=(this.cols*this.options.widget_base_dimensions[0])+((this.cols-1)*2*this.options.widget_margins[0]);if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this.generate_faux_grid(this.rows,this.cols)};b.destroy=function(){e(d).unbind(".gridster");if(this.drag_api){this.drag_api.destroy()}this.remove_style_tags();this.$el.remove();return this};e.fn.gridster=function(h){return this.each(function(){if(!e(this).data("gridster")){e(this).data("gridster",new c(this,h))}})};e.Gridster=b}(jQuery,window,document));