(function(e,d,a,g){var f={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,min_rows:15,max_size_x:6,autogenerate_stylesheet:true,avoid_overlapped_widgets:true,serialize_params:function(i,h){return{col:h.col,row:h.row,size_x:h.size_x,size_y:h.size_y}},collision:{},draggable:{distance:4}};function c(i,h){this.options=e.extend(true,f,h);this.$el=e(i);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs_w");this.widgets=[];this.$changed=e([]);this.wrapper_width=this.$wrapper.width();this.min_widget_width=(this.options.widget_margins[0]*2)+this.options.widget_base_dimensions[0];this.min_widget_height=(this.options.widget_margins[1]*2)+this.options.widget_base_dimensions[1];this.init()}c.generated_stylesheets=[];var b=c.prototype;b.init=function(){this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.$wrapper.addClass("ready");this.draggable();this.on_window_resize=throttle(e.proxy(this.recalculate_faux_grid,this),200);e(d).bind("resize",this.on_window_resize)};b.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};b.enable=function(){this.drag_api.enable();return this};b.add_widget=function(k,j,h,i,m){var n;j||(j=1);h||(h=1);if(!i&!m){n=this.next_position(j,h)}else{n={col:i,row:m};this.empty_cells(i,m,j,h)}var l=e(k).attr({"data-col":n.col,"data-row":n.row,"data-sizex":j,"data-sizey":h}).addClass("gs_w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(l);this.register_widget(l);this.add_faux_rows(n.size_y);this.set_dom_grid_height();return l.fadeIn()};b.resize_widget=function(m,y,x){var z=m.coords().grid;y||(y=z.size_x);x||(x=z.size_y);if(y>this.cols){y=this.cols}var D=this.get_cells_occupied(z);var o=z.size_x;var n=z.size_y;var h=z.col;var u=h;var k=y>o;var C=x>n;if(h+y-1>this.cols){var s=h+(y-1)-this.cols;var B=h-s;u=Math.max(1,B)}var q={col:u,row:z.row,size_x:y,size_y:x};var t=this.get_cells_occupied(q);var w=[];e.each(D.cols,function(F,E){if(e.inArray(E,t.cols)===-1){w.push(E)}});var j=[];e.each(t.cols,function(F,E){if(e.inArray(E,D.cols)===-1){j.push(E)}});var v=[];e.each(D.rows,function(E,F){if(e.inArray(F,t.rows)===-1){v.push(F)}});var i=[];e.each(t.rows,function(E,F){if(e.inArray(F,D.rows)===-1){i.push(F)}});this.remove_from_gridmap(z);if(j.length){var A=[u,z.row,y,Math.min(n,x),m];this.empty_cells.apply(this,A)}if(i.length){var r=[u,z.row,y,x,m];this.empty_cells.apply(this,r)}z.col=u;z.size_x=y;z.size_y=x;this.add_to_gridmap(q,m);m.data("coords").update({width:(y*this.options.widget_base_dimensions[0]+((y-1)*this.options.widget_margins[0])*2),height:(x*this.options.widget_base_dimensions[1]+((x-1)*this.options.widget_margins[1])*2)});if(x>n){this.add_faux_rows(x-n)}if(y>o){this.add_faux_cols(y-o)}m.attr({"data-col":u,"data-sizex":y,"data-sizey":x});if(w.length){var l=[w[0],z.row,w.length,Math.min(n,x),m];this.remove_empty_cells.apply(this,l)}if(v.length){var p=[u,z.row,y,x,m];this.remove_empty_cells.apply(this,p)}return m};b.empty_cells=function(k,l,j,i,m){var h=this.widgets_below({col:k,row:l-i,size_x:j,size_y:i});h.not(m).each(e.proxy(function(p,n){var o=e(n).coords().grid;if(!(o.row<=(l+i-1))){return}var q=(l+i)-o.row;this.move_widget_down(e(n),q)},this));this.set_dom_grid_height();return this};b.remove_empty_cells=function(l,m,k,j,i){var h=this.widgets_below({col:l,row:m,size_x:k,size_y:j});h.not(i).each(e.proxy(function(n,o){this.move_widget_up(e(o),j)},this));this.set_dom_grid_height();return this};b.next_position=function(p,o){p||(p=1);o||(o=1);var n=this.gridmap;var m=n.length;var l=[];var i;for(var k=1;k<m;k++){i=n[k].length;for(var h=1;h<=i;h++){var j=this.can_move_to({size_x:p,size_y:o},k,h);if(j){l.push({col:k,row:h,size_y:o,size_x:p})}}}if(l.length){return this.sort_by_row_and_col_asc(l)[0]}return false};b.remove_widget=function(l,i,m){var k=l instanceof jQuery?l:e(l);var j=k.coords().grid;if(e.isFunction(i)){m=i;i=false}this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(k);var h=this.widgets_below(k);this.remove_from_gridmap(j);k.fadeOut(e.proxy(function(){k.remove();if(!i){h.each(e.proxy(function(n,o){this.move_widget_up(e(o),j.size_y)},this))}this.set_dom_grid_height();if(m){m.call(this,l)}},this))};b.remove_all_widgets=function(h){this.$widgets.each(e.proxy(function(j,k){this.remove_widget(k,true,h)},this));return this};b.serialize=function(i){i||(i=this.$widgets);var h=[];i.each(e.proxy(function(j,k){h.push(this.options.serialize_params(e(k),e(k).coords().grid))},this));return h};b.serialize_changed=function(){return this.serialize(this.$changed)};b.register_widget=function(i){var h={col:parseInt(i.attr("data-col"),10),row:parseInt(i.attr("data-row"),10),size_x:parseInt(i.attr("data-sizex"),10),size_y:parseInt(i.attr("data-sizey"),10),el:i};if(this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:h.size_x,size_y:h.size_y},h.col,h.row)){h=this.next_position(h.size_x,h.size_y);h.el=i;i.attr({"data-col":h.col,"data-row":h.row,"data-sizex":h.size_x,"data-sizey":h.size_y})}i.data("coords",i.coords());i.data("coords").grid=h;this.add_to_gridmap(h,i);return this};b.update_widget_position=function(h,i){this.for_each_cell_occupied(h,function(j,k){if(!this.gridmap[j]){return this}this.gridmap[j][k]=i});return this};b.remove_from_gridmap=function(h){return this.update_widget_position(h,false)};b.add_to_gridmap=function(i,j){this.update_widget_position(i,j||i.el);if(i.el){var h=this.widgets_below(i.el);h.each(e.proxy(function(k,l){this.move_widget_up(e(l))},this))}};b.draggable=function(){var h=this;var i=e.extend(true,{},this.options.draggable,{offset_left:this.options.widget_margins[0],start:function(j,k){h.$widgets.filter(".player-revert").removeClass("player-revert");h.$player=e(this);h.$helper=h.options.draggable.helper==="clone"?e(k.helper):h.$player;h.helper=!h.$helper.is(h.$player);h.on_start_drag.call(h,j,k);h.$el.trigger("gridster:dragstart")},stop:function(j,k){h.on_stop_drag.call(h,j,k);h.$el.trigger("gridster:dragstop")},drag:throttle(function(j,k){h.on_drag.call(h,j,k);h.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.drag(i).data("drag");return this};b.on_start_drag=function(i,k){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=e.extend({},this.player_grid_data);this.$el.css("height",this.$el.height()+(this.player_grid_data.size_y*this.min_widget_height));var h=this.faux_grid;var j=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(h,this.options.collision);this.$preview_holder=e("<li />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:j.width,height:j.height}}).appendTo(this.$el);if(this.options.draggable.start){this.options.draggable.start.call(this,i,k)}};b.on_drag=function(i,j){if(this.$player===null){return false}var h={left:j.position.left+this.baseX,top:j.position.top+this.baseY};this.colliders_data=this.collision_api.get_closest_colliders(h);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);if(this.helper&&this.$player){this.$player.css({left:j.position.left,top:j.position.top})}if(this.options.draggable.drag){this.options.draggable.drag.call(this,i,j)}};b.on_stop_drag=function(h,i){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");i.position.left=i.position.left+this.baseX;i.position.top=i.position.top+this.baseY;this.colliders_data=this.collision_api.get_closest_colliders(i.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""});this.$changed=this.$changed.add(this.$player);this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row);this.$player.coords().grid.row=this.placeholder_grid_data.row;this.$player.coords().grid.col=this.placeholder_grid_data.col;if(this.options.draggable.stop){this.options.draggable.stop.call(this,h,i)}this.$preview_holder.remove();this.$player=null;this.$helper=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.set_dom_grid_height()};b.on_overlapped_column_change=function(j,n){if(!this.colliders_data.length){return this}var l=this.get_targeted_columns(this.colliders_data[0].el.data.col);var m=this.last_cols.length;var k=l.length;var h;for(h=0;h<k;h++){if(e.inArray(l[h],this.last_cols)===-1){(j||e.noop).call(this,l[h])}}for(h=0;h<m;h++){if(e.inArray(this.last_cols[h],l)===-1){(n||e.noop).call(this,this.last_cols[h])}}this.last_cols=l;return this};b.on_overlapped_row_change=function(j,k){if(!this.colliders_data.length){return this}var m=this.get_targeted_rows(this.colliders_data[0].el.data.row);var n=this.last_rows.length;var l=m.length;var h;for(h=0;h<l;h++){if(e.inArray(m[h],this.last_rows)===-1){(j||e.noop).call(this,m[h])}}for(h=0;h<n;h++){if(e.inArray(this.last_rows[h],m)===-1){(k||e.noop).call(this,this.last_rows[h])}}this.last_rows=m};b.set_player=function(k,q,h){var p=this;if(!h){this.empty_cells_player_occupies()}var o=!h?p.colliders_data[0].el.data:{col:k};var m=o.col;var i=q||o.row;this.player_grid_data={col:m,row:i,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var n=this.get_widgets_overlapped(this.player_grid_data);var l=this.widgets_constraints(n);this.manage_movements(l.can_go_up,m,i);this.manage_movements(l.can_not_go_up,m,i);if(!n.length){var j=this.can_go_player_up(this.player_grid_data);if(j!==false){i=j}this.set_placeholder(m,i)}return{col:m,row:i}};b.widgets_constraints=function(i){var h=e([]);var k;var j=[];var l=[];i.each(e.proxy(function(o,m){var p=e(m);var n=p.coords().grid;if(this.can_go_widget_up(n)){h=h.add(p);j.push(n)}else{l.push(n)}},this));k=i.not(h);return{can_go_up:this.sort_by_row_asc(j),can_not_go_up:this.sort_by_row_desc(l)}};b.sort_by_row_asc=function(h){h=h.sort(function(j,i){if(!j.row){j=e(j).coords().grid;i=e(i).coords().grid}if(j.row>i.row){return 1}return -1});return h};b.sort_by_row_and_col_asc=function(h){h=h.sort(function(j,i){if(j.row>i.row||j.row===i.row&&j.col>i.col){return 1}return -1});return h};b.sort_by_col_asc=function(h){h=h.sort(function(j,i){if(j.col>i.col){return 1}return -1});return h};b.sort_by_row_desc=function(h){h=h.sort(function(j,i){if(j.row+j.size_y<i.row+i.size_y){return 1}return -1});return h};b.manage_movements=function(i,j,h){e.each(i,e.proxy(function(n,l){var m=l;var p=m.el;var k=this.can_go_widget_up(m);if(k){this.move_widget_to(p,k);this.set_placeholder(j,k+m.size_y)}else{var o=this.can_go_player_up(this.player_grid_data);if(!o){var q=(h+this.player_grid_data.size_y)-m.row;this.move_widget_down(p,q);this.set_placeholder(j,h)}}},this));return this};b.is_player=function(i,j){if(j&&!this.gridmap[i]){return false}var h=j?this.gridmap[i][j]:i;return h&&(h.is(this.$player)||h.is(this.$helper))};b.is_player_in=function(h,i){var j=this.cells_occupied_by_player||{};return e.inArray(h,j.cols)>=0&&e.inArray(i,j.rows)>=0};b.is_placeholder_in=function(h,i){var j=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(h)&&e.inArray(i,j.rows)>=0};b.is_placeholder_in_col=function(h){var i=this.cells_occupied_by_placeholder||[];return e.inArray(h,i.cols)>=0};b.is_empty=function(h,i){if(typeof this.gridmap[h]!=="undefined"&&typeof this.gridmap[h][i]!=="undefined"&&this.gridmap[h][i]===false){return true}return false};b.is_occupied=function(h,i){if(!this.gridmap[h]){return false}if(this.gridmap[h][i]){return true}return false};b.is_widget=function(i,j){var h=this.gridmap[i];if(!h){return false}h=h[j];if(h){return h}return false};b.is_widget_under_player=function(h,i){if(this.is_widget(h,i)){return this.is_player_in(h,i)}return false};b.get_widgets_under_player=function(i){i||(i=this.cells_occupied_by_player||{cols:[],rows:[]});var h=e([]);e.each(i.cols,e.proxy(function(k,j){e.each(i.rows,e.proxy(function(l,m){if(this.is_widget(j,m)){h=h.add(this.gridmap[j][m])}},this))},this));return h};b.set_placeholder=function(k,n){var j=e.extend({},this.placeholder_grid_data);var h=this.widgets_below({col:j.col,row:j.row,size_y:j.size_y,size_x:j.size_x});var i=(k+j.size_x-1);if(i>this.cols){k=k-(i-k)}var o=this.placeholder_grid_data.row<n;var l=this.placeholder_grid_data.col!==k;this.placeholder_grid_data.col=k;this.placeholder_grid_data.row=n;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":n,"data-col":k});if(o||l){h.each(e.proxy(function(p,q){this.move_widget_up(e(q),this.placeholder_grid_data.col-k+j.size_y)},this))}var m=this.get_widgets_under_player(this.cells_occupied_by_placeholder);if(m.length){m.each(e.proxy(function(p,r){var q=e(r);this.move_widget_down(q,n+j.size_y-q.data("coords").grid.row)},this))}};b.can_go_player_up=function(m){var j=m.row+m.size_y-1;var h=true;var i=[];var l=10000;var k=this.get_widgets_under_player();this.for_each_column_occupied(m,function(p){var n=this.gridmap[p];var o=j+1;i[p]=[];while(--o>0){if(this.is_empty(p,o)||this.is_player(p,o)||this.is_widget(p,o)&&n[o].is(k)){i[p].push(o);l=o<l?o:l}else{break}}if(i[p].length===0){h=false;return true}i[p].sort()});if(!h){return false}return this.get_valid_rows(m,i,l)};b.can_go_widget_up=function(l){var j=l.row+l.size_y-1;var h=true;var i=[];var k=10000;this.for_each_column_occupied(l,function(o){var m=this.gridmap[o];i[o]=[];var n=j+1;while(--n>0){if(this.is_widget(o,n)&&!this.is_player_in(o,n)){if(!m[n].is(l.el)){break}}if(!this.is_player(o,n)&&!this.is_placeholder_in(o,n)&&!this.is_player_in(o,n)){i[o].push(n)}if(n<k){k=n}}if(i[o].length===0){h=false;return true}i[o].sort()});if(!h){return false}return this.get_valid_rows(l,i,k)};b.get_valid_rows=function(i,q,p){var n=i.row;var l=i.row+i.size_y-1;var o=i.size_y;var h=p-1;var j=[];while(++h<=l){var m=true;e.each(q,function(r,s){if(e.isArray(s)&&e.inArray(h,s)===-1){m=false}});if(m===true){j.push(h);if(j.length===o){break}}}var k=false;if(o===1){if(j[0]!==n){k=j[0]||false}}else{if(j[0]!==n){k=this.get_consecutive_numbers_index(j,o)}}return k};b.get_consecutive_numbers_index=function(k,l){var j=k.length;var h=[];var o=true;var n=-1;for(var m=0;m<j;m++){if(o||k[m]===n+1){h.push(m);if(h.length===l){break}o=false}else{h=[];o=true}n=k[m]}return h.length>=l?k[h[0]]:false};b.get_widgets_overlapped=function(){var k;var h=e([]);var j=[];var i=this.cells_occupied_by_player.rows.slice(0);i.reverse();e.each(this.cells_occupied_by_player.cols,e.proxy(function(m,l){e.each(i,e.proxy(function(n,p){if(!this.gridmap[l]){return true}var o=this.gridmap[l][p];if(this.is_occupied(l,p)&&!this.is_player(o)&&e.inArray(o,j)===-1){h=h.add(o);j.push(o)}},this))},this));return h};b.on_start_overlapping_column=function(h){this.set_player(h,false)};b.on_start_overlapping_row=function(h){this.set_player(false,h)};b.on_stop_overlapping_column=function(i){this.set_player(i,false);var h=this;this.for_each_widget_below(i,this.cells_occupied_by_player.rows[0],function(k,j){h.move_widget_up(this,h.player_grid_data.size_y)})};b.on_stop_overlapping_row=function(k){this.set_player(false,k);var i=this;var j=this.cells_occupied_by_player.cols;for(var l=0,h=j.length;l<h;l++){this.for_each_widget_below(j[l],k,function(n,m){i.move_widget_up(this,i.player_grid_data.size_y)})}};b.move_widget_to=function(n,m){var h=this;var j=n.coords().grid;var l=m-j.row;var k=this.widgets_below(n);var i=this.can_move_to(j,j.col,m,n);if(i===false){return false}this.remove_from_gridmap(j);j.row=m;this.add_to_gridmap(j);n.attr("data-row",m);this.$changed=this.$changed.add(n);k.each(function(p,r){var q=e(r);var o=q.coords().grid;var s=h.can_go_widget_up(o);if(s&&s!==o.row){h.move_widget_to(q,s)}});return this};b.move_widget_up=function(m,l){var k=m.coords().grid;var h=k.row;var i=[];var j=true;l||(l=1);if(!this.can_go_up(m)){return false}this.for_each_column_occupied(k,function(n){if(e.inArray(m,i)===-1){var o=m.coords().grid;var p=h-l;p=this.can_go_up_to_row(o,n,p);if(!p){return true}var q=this.widgets_below(m);this.remove_from_gridmap(o);o.row=p;this.add_to_gridmap(o);m.attr("data-row",o.row);this.$changed=this.$changed.add(m);i.push(m);q.each(e.proxy(function(r,s){this.move_widget_up(e(s),l)},this))}})};b.move_widget_down=function(h,l){var i=h.coords().grid;var o=i.row;var n=[];var m=l;if(!h){return false}if(e.inArray(h,n)===-1){var k=h.coords().grid;var p=o+l;var j=this.widgets_below(h);this.remove_from_gridmap(k);j.each(e.proxy(function(r,u){var t=e(u);var s=t.coords().grid;var q=this.displacement_diff(s,k,m);if(q>0){this.move_widget_down(t,q)}},this));k.row=p;this.update_widget_position(k,h);h.attr("data-row",k.row);this.$changed=this.$changed.add(h);n.push(h)}};b.can_go_up_to_row=function(j,i,q){var o=this.gridmap;var s=true;var l=[];var n=j.row;var h;this.for_each_column_occupied(j,function(t){var r=o[t];l[t]=[];h=n;while(h--){if(this.is_empty(t,h)&&!this.is_placeholder_in(t,h)){l[t].push(h)}else{break}}if(!l[t].length){s=false;return true}});if(!s){return false}h=q;for(h=1;h<n;h++){var m=true;for(var p=0,k=l.length;p<k;p++){if(l[p]&&e.inArray(h,l[p])===-1){m=false}}if(m===true){s=h;break}}return s};b.displacement_diff=function(k,l,n){var i=k.row;var m=[];var j=l.row+l.size_y;this.for_each_column_occupied(k,function(o){var q=0;for(var p=j;p<i;p++){if(this.is_empty(o,p)){q=q+1}}m.push(q)});var h=Math.max.apply(Math,m);n=(n-h);return n>0?n:0};b.widgets_below=function(j){var l=e.isPlainObject(j)?j:j.coords().grid;var i=this;var m=this.gridmap;var k=l.row+l.size_y-1;var h=e([]);this.for_each_column_occupied(l,function(n){i.for_each_widget_below(n,k,function(p,o){if(!i.is_player(this)&&e.inArray(this,h)===-1){h=h.add(this);return true}})});return this.sort_by_row_asc(h)};b.set_cells_player_occupies=function(h,i){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=h;this.placeholder_grid_data.row=i;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};b.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};b.can_go_up=function(j){var m=j.coords().grid;var k=m.row;var l=k-1;var n=this.gridmap;var i=[];var h=true;if(k===1){return false}this.for_each_column_occupied(m,function(o){var p=this.is_widget(o,l);if(this.is_occupied(o,l)||this.is_player(o,l)||this.is_placeholder_in(o,l)||this.is_player_in(o,l)){h=false;return true}});return h};b.can_move_to=function(i,h,o,m){var n=this.gridmap;var j=i.el;var k={size_y:i.size_y,size_x:i.size_x,col:h,row:o};var p=true;var l=h+i.size_x-1;if(l>this.cols){return false}if(m&&m<o+i.size_y-1){return false}this.for_each_cell_occupied(k,function(s,r){var q=this.is_widget(s,r);if(q&&(!i.el||q.is(j))){p=false}});return p};b.get_targeted_columns=function(k){var h=(k||this.player_grid_data.col)+(this.player_grid_data.size_x-1);var j=[];for(var i=k;i<=h;i++){j.push(i)}return j};b.get_targeted_rows=function(i){var h=(i||this.player_grid_data.row)+(this.player_grid_data.size_y-1);var j=[];for(var k=i;k<=h;k++){j.push(k)}return j};b.get_cells_occupied=function(l){var j={cols:[],rows:[]};var k;if(arguments[1] instanceof jQuery){l=arguments[1].coords().grid}for(k=0;k<l.size_x;k++){var h=l.col+k;j.cols.push(h)}for(k=0;k<l.size_y;k++){var m=l.row+k;j.rows.push(m)}return j};b.for_each_cell_occupied=function(h,i){this.for_each_column_occupied(h,function(j){this.for_each_row_occupied(h,function(k){i.call(this,j,k)})});return this};b.for_each_column_occupied=function(k,l){for(var j=0;j<k.size_x;j++){var h=k.col+j;l.call(this,h,k)}};b.for_each_row_occupied=function(j,l){for(var h=0;h<j.size_y;h++){var k=j.row+h;l.call(this,k,j)}};b._traversing_widgets=function(n,q,j,t,r){var s=this.gridmap;if(!s[j]){return}var m,p;var l=n+"/"+q;if(arguments[2] instanceof jQuery){var h=arguments[2].coords().grid;j=h.col;t=h.row;r=arguments[3]}var i=[];var o=t;var k={"for_each/above":function(){while(o--){if(o>0&&this.is_widget(j,o)&&e.inArray(s[j][o],i)===-1){m=r.call(s[j][o],j,o);i.push(s[j][o]);if(m){break}}}},"for_each/below":function(){for(o=t+1,p=s[j].length;o<p;o++){if(this.is_widget(j,o)&&e.inArray(s[j][o],i)===-1){m=r.call(s[j][o],j,o);i.push(s[j][o]);if(m){break}}}}};if(k[l]){k[l].call(this)}};b.for_each_widget_above=function(h,i,j){this._traversing_widgets("for_each","above",h,i,j);return this};b.for_each_widget_below=function(h,i,j){this._traversing_widgets("for_each","below",h,i,j);return this};b.get_highest_occupied_cell=function(){var i;var k=this.gridmap;var j=[];var m=[];for(var l=k.length-1;l>=1;l--){for(i=k[l].length-1;i>=1;i--){if(this.is_widget(l,i)){j.push(i);m[i]=l;break}}}var h=Math.max.apply(Math,j);this.highest_occupied_cell={col:m[h],row:h};return this.highest_occupied_cell};b.get_widgets_from=function(i,k){var j=this.gridmap;var h=e();if(i){h=h.add(this.$widgets.filter(function(){var l=e(this).attr("data-col");return(l===i||l>i)}))}if(k){h=h.add(this.$widgets.filter(function(){var l=e(this).attr("data-row");return(l===k||l>k)}))}return h};b.set_dom_grid_height=function(){var h=this.get_highest_occupied_cell().row;this.$el.css("height",h*this.min_widget_height);return this};b.generate_stylesheet=function(h){var r="";var o=this.options.max_size_x;var m=0;var l=0;var k;var q;h||(h={});h.cols||(h.cols=this.cols);h.rows||(h.rows=this.rows);h.namespace||(h.namespace=this.options.namespace);h.widget_base_dimensions||(h.widget_base_dimensions=this.options.widget_base_dimensions);h.widget_margins||(h.widget_margins=this.options.widget_margins);h.min_widget_width=(h.widget_margins[0]*2)+h.widget_base_dimensions[0];h.min_widget_height=(h.widget_margins[1]*2)+h.widget_base_dimensions[1];var j=e.param(h);if(e.inArray(j,c.generated_stylesheets)>=0){return false}c.generated_stylesheets.push(j);for(k=h.cols;k>=0;k--){r+=(h.namespace+' [data-col="'+(k+1)+'"] { left:'+((k*h.widget_base_dimensions[0])+(k*h.widget_margins[0])+((k+1)*h.widget_margins[0]))+"px;} ")}for(k=h.rows;k>=0;k--){r+=(h.namespace+' [data-row="'+(k+1)+'"] { top:'+((k*h.widget_base_dimensions[1])+(k*h.widget_margins[1])+((k+1)*h.widget_margins[1]))+"px;} ")}for(var n=1;n<=h.rows;n++){r+=(h.namespace+' [data-sizey="'+n+'"] { height:'+(n*h.widget_base_dimensions[1]+(n-1)*(h.widget_margins[1]*2))+"px;}")}for(var p=1;p<=o;p++){r+=(h.namespace+' [data-sizex="'+p+'"] { width:'+(p*h.widget_base_dimensions[0]+(p-1)*(h.widget_margins[0]*2))+"px;}")}return this.add_style_tag(r)};b.add_style_tag=function(i){var j=a;var h=j.createElement("style");j.getElementsByTagName("head")[0].appendChild(h);h.setAttribute("type","text/css");if(h.styleSheet){h.styleSheet.cssText=i}else{h.appendChild(a.createTextNode(i))}return this};b.generate_faux_grid=function(i,j){this.faux_grid=[];this.gridmap=[];var h;var k;for(h=j;h>0;h--){this.gridmap[h]=[];for(k=i;k>0;k--){this.add_faux_cell(k,h)}}return this};b.add_faux_cell=function(j,h){var i=e({left:this.baseX+((h-1)*this.min_widget_width),top:this.baseY+(j-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:h,row:j,original_col:h,original_row:j}).coords();if(!e.isArray(this.gridmap[h])){this.gridmap[h]=[]}this.gridmap[h][j]=false;this.faux_grid.push(i);return this};b.add_faux_rows=function(k){var i=this.rows;var h=i+(k||1);for(var j=h;j>i;j--){for(var l=this.cols;l>=1;l--){this.add_faux_cell(j,l)}}this.rows=h;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};b.add_faux_cols=function(k){var i=this.cols;var h=i+(k||1);for(var l=i;l<h;l++){for(var j=this.rows;j>=1;j--){this.add_faux_cell(j,l)}}this.cols=h;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};b.recalculate_faux_grid=function(){var h=this.$wrapper.width();this.baseX=(e(d).width()-h)/2;this.baseY=this.$wrapper.offset().top;e.each(this.faux_grid,e.proxy(function(j,k){this.faux_grid[j]=k.update({left:this.baseX+(k.data.col-1)*this.min_widget_width,top:this.baseY+(k.data.row-1)*this.min_widget_height})},this));return this};b.get_widgets_from_DOM=function(){this.$widgets.each(e.proxy(function(h,j){this.register_widget(e(j))},this));return this};b.generate_grid_and_stylesheet=function(){var m=this.$wrapper.width();var j=this.$wrapper.height();var l=Math.floor(m/this.min_widget_width)+this.options.extra_cols;var k=this.$widgets.map(function(){return e(this).attr("data-col")});k=Array.prototype.slice.call(k,0);k.length||(k=[0]);var i=Math.max.apply(Math,k);var h=this.options.extra_rows;this.$widgets.each(function(o,n){h+=(+e(n).attr("data-sizey"))});this.cols=Math.max(i,l,this.options.min_cols);this.rows=Math.max(h,this.options.min_rows);this.baseX=(e(d).width()-m)/2;this.baseY=this.$wrapper.offset().top;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this.generate_faux_grid(this.rows,this.cols)};b.destroy=function(){e(d).unbind("resize",this.on_window_resize);if(this.drag_api){this.drag_api.destroy()}this.$el.remove()};e.fn.gridster=function(h){return this.each(function(){if(!e(this).data("gridster")){e(this).data("gridster",new c(this,h))}})};e.Gridster=b}(jQuery,window,document));