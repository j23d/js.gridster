(function(f,h,i,c){var d={items:".gs_w",distance:1,limit:true,offset_left:0,autoscroll:true,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null};var b=f(h);var e=!!("ontouchstart" in h);var g={start:e?"touchstart":"mousedown.draggable",move:e?"touchmove":"mousemove.draggable",end:e?"touchend":"mouseup.draggable"};function a(l,k){this.options=f.extend({},d,k);this.$body=f(i.body);this.$container=f(l);this.$dragitems=f(this.options.items,this.$container);this.is_dragging=false;this.player_min_left=0+this.options.offset_left;this.init()}var j=a.prototype;j.init=function(){this.calculate_positions();this.$container.css("position","relative");this.disabled=false;this.events();this.on_window_resize=throttle(f.proxy(this.calculate_positions,this),200);f(h).bind("resize",this.on_window_resize)};j.events=function(){this.proxied_on_select_start=f.proxy(this.on_select_start,this);this.$container.on("selectstart",this.proxied_on_select_start);this.proxied_drag_handler=f.proxy(this.drag_handler,this);this.$container.on(g.start,this.options.items,this.proxied_drag_handler);this.proxied_pointer_events_end=f.proxy(function(k){this.is_dragging=false;if(this.disabled){return}this.$body.off(g.move);if(this.drag_start){this.on_dragstop(k)}},this);this.$body.on(g.end,this.proxied_pointer_events_end)};j.get_actual_pos=function(k){var l=k.position();return l};j.get_mouse_pos=function(k){if(e){var l=k.originalEvent;k=l.touches.length?l.touches[0]:l.changedTouches[0]}return{left:k.clientX,top:k.clientY}};j.get_offset=function(p){p.preventDefault();var k=this.get_mouse_pos(p);var o=Math.round(k.left-this.mouse_init_pos.left);var l=Math.round(k.top-this.mouse_init_pos.top);var n=Math.round(this.el_init_offset.left+o-this.baseX);var m=Math.round(this.el_init_offset.top+l-this.baseY+this.scrollOffset);if(this.options.limit){if(n>this.player_max_left){n=this.player_max_left}else{if(n<this.player_min_left){n=this.player_min_left}}}return{left:n,top:m,mouse_left:k.left,mouse_top:k.top}};j.manage_scroll=function(o){var t;var m=b.scrollTop();var s=m;var r=s+this.window_height;var l=r-50;var k=s+50;var p=o.mouse_left;var q=s+o.mouse_top;var n=(this.doc_height-this.window_height+this.player_height);if(q>=l){t=m+30;if(t<n){b.scrollTop(t);this.scrollOffset=this.scrollOffset+30}}if(q<=k){t=m-30;if(t>0){b.scrollTop(t);this.scrollOffset=this.scrollOffset-30}}};j.calculate_positions=function(k){this.window_height=b.height()};j.drag_handler=function(m){var l=m.target.nodeName;if(this.disabled||m.which!==1&&!e){return}if(this.ignore_drag(m)){return}var k=this;var n=true;this.$player=f(m.currentTarget);this.el_init_pos=this.get_actual_pos(this.$player);this.mouse_init_pos=this.get_mouse_pos(m);this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top;this.on_pointer_events_move=function(r){var o=k.get_mouse_pos(r);var q=Math.abs(o.left-k.mouse_init_pos.left);var p=Math.abs(o.top-k.mouse_init_pos.top);if(!(q>k.options.distance||p>k.options.distance)){return false}if(n){n=false;k.on_dragstart.call(k,r);return false}if(k.is_dragging===true){k.on_dragmove.call(k,r)}return false};this.$body.on(g.move,this.on_pointer_events_move);return false};j.on_dragstart=function(k){k.preventDefault();this.drag_start=true;this.is_dragging=true;var l=this.$container.offset();this.baseX=Math.round(l.left);this.baseY=Math.round(l.top);this.doc_height=f(i).height();if(this.options.helper==="clone"){this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper");this.helper=true}else{this.helper=false}this.scrollOffset=0;this.el_init_offset=this.$player.offset();this.player_width=this.$player.width();this.player_height=this.$player.height();this.player_max_left=(this.$container.width()-this.player_width+this.options.offset_left);if(this.options.start){this.options.start.call(this.$player,k,{helper:this.helper?this.$helper:this.$player})}return false};j.on_dragmove=function(l){var m=this.get_offset(l);this.options.autoscroll&&this.manage_scroll(m);(this.helper?this.$helper:this.$player).css({position:"absolute",left:m.left,top:m.top});var k={position:{left:m.left,top:m.top}};if(this.options.drag){this.options.drag.call(this.$player,l,k)}return false};j.on_dragstop=function(l){var m=this.get_offset(l);this.drag_start=false;var k={position:{left:m.left,top:m.top}};if(this.options.stop){this.options.stop.call(this.$player,l,k)}if(this.helper){this.$helper.remove()}return false};j.on_select_start=function(k){if(this.disabled){return}if(this.ignore_drag(k)){return}return false};j.enable=function(){this.disabled=false};j.disable=function(){this.disabled=true};j.destroy=function(){this.disable();this.$container.off("selectstart",this.proxied_on_select_start);this.$container.off(g.start,this.proxied_drag_handler);this.$body.off(g.end,this.proxied_pointer_events_end);this.$body.off(g.move,this.on_pointer_events_move);f(h).unbind("resize",this.on_window_resize);f.removeData(this.$container,"drag")};j.ignore_drag=function(k){if(this.options.handle){return !f(k.target).is(this.options.handle)}return f.inArray(k.target.nodeName,this.options.ignore_dragging)>=0};f.fn.drag=function(k){return this.each(function(){if(!f.data(this,"drag")){f.data(this,"drag",new a(this,k))}})}}(jQuery,window,document));